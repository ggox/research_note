### Raft协议

#### 角色

* Follower
* Candidate
* Leader

### 流程

* Leader选举

  1. 最初大家都是Follower，每个节点都有自己的计时器，当计时达到超时时间时，该节点转变为Candidate
  2. 称为Candidate节点，会首先给自己投票，然后向集群中其他所有的节点发起请求，要求大家给自己投票
  3. 其他收到投票请求且还未投票的Follower节点会向发起者投票，发起者收到反馈后，票数增加
  4. 当票数超过集群节点的一半，该节点晋升为Leader节点。Leader节点会立刻向其他节点发出通知，告诉大家自己才是老大。收到通知的节点全部变为Follower，并且各自的计时器清零
  5. Leader节点每隔一段时间向集群其他节点发送心跳通知，表明自己存活
  6. Leader宕机，重新选举

  *注意：为了选举效率，每个节点的超时时间都不一样，降低选举竞争*

  

* 数据同步

	1. 客户端提交数据到Leader节点
	2. Leader节点把数据复制到集群内所有的Follower节点，如果失败会不断重试
  3. Follower节点接收到复制的数据，反馈给Leader节点
  4. 如果Leader节点接收到超过半数Follower的反馈，表明复制成功。于是提交自己的数据，并通知客户端数据提交成功
  5. Leader节点通知集群内的所有Follower节点提交数据，从而完成数据的同步流程

  

  